function initSelectionWidget(){function e(){"PerTrip"==$("#mode").val()?($("label[for='enddate']").html("Return Date"),$("#enddate").prop("disabled",!0),$("#endtime").prop("disabled",!0),$("#endtime").closest(".selector").addClass("is-disabled"),$("#enddate").val("")):($("label[for='enddate']").html('Return Date <span class="required">*</span>'),$("#enddate").prop("disabled",!1),$("#endtime").prop("disabled",!1),$("#endtime").closest(".selector").removeClass("is-disabled"))}function a(e,a,i,t){var s,n;null==e||""==e||null==i||""==i?(s=new Date,s.setHours(a.substr(0,a.indexOf(":"))),s.setMinutes(a.substr(a.indexOf(":")+1)),n=new Date,n.setHours(t.substr(0,t.indexOf(":"))),n.setMinutes(t.substr(t.indexOf(":")+1))):(s=new Date(e+" "+a),n=new Date(i+" "+t));var l=(n-s)/1e3/60/60;return(isNaN(l)||3>l)&&(l=3),Math.ceil(l)}function i(e,a,i,t){var s=0;return"Hourly"==a?s=(i*e).toFixed(2):"PerTrip"==a?s=t.toFixed(2):void 0}function t(){if(s.length>0?(o.addClass("is-active"),$("body").addClass("selectionPane-active")):(o.removeClass("is-active"),$("body").removeClass("selectionPane-active")),r||(o.find("ul").empty(),$.each(s,function(e,a){var i=l.find('.card[data-id="'+a.id+'"] img').attr("src");o.find("ul").append('<li><a href="" data-id="'+a.id+'" class="icon icon--close-small selectionPane-remove js-remove"></a><figure> <img src="'+i+'" alt=""/></figure><span class="selectionPane-model">'+a.model+"</span></li>")})),r){var e=s[0],t=l.find('.card[data-id="'+e.id+'"] img').attr("src"),n=parseFloat(l.find('.card[data-id="'+e.id+'"] span.card-hourly').html()),d=parseFloat(l.find('.card[data-id="'+e.id+'"] span.card-pertrip').html());$("input[id=model]").val(e.model),o.find("figure img").attr("src",t).end().find(".js-selectionPane-model").text(e.model);var c=l.find('.card[data-id="'+e.id+'"] div.startSeason').html(),p=l.find('.card[data-id="'+e.id+'"] div.endSeason').html();if(new Date($("#startdate").val()).getTime()>=new Date(c).getTime()&&new Date($("#startdate").val()).getTime()<=new Date(p).getTime()||new Date($("#enddate").val()).getTime()>=new Date(c).getTime()&&new Date($("#enddate").val()).getTime()<=new Date(p).getTime()){var u=l.find('.card[data-id="'+e.id+'"] div.minhours').html(),v=l.find('.card[data-id="'+e.id+'"] div.price-title').html(),f=l.find('.card[data-id="'+e.id+'"] div.card-seasonal-disposal').html(),g=l.find('.card[data-id="'+e.id+'"] div.card-seasonal-transfer').html();"PerTrip"==$("#mode").val()?o.find(".js-selectionPane-model").html(e.model+' <span class="tag">$'+g+"/hr due to the "+v+" peak-period</span>"):o.find(".js-selectionPane-model").html(e.model+' <span class="tag">$'+f+"/hr and min. "+u+" hour charge due to the "+v+" peak-period</span>");var m=a($("#startdate").val(),$("#starttime").val(),$("#enddate").val(),$("#endtime").val());(isNaN(m)||u>m)&&(m=u),o.find("span.card-pricing-value").html("$"+i(m,$("#mode").val(),parseFloat(f),parseFloat(g)))}else o.find("span.card-pricing-value").html("$"+i(a($("#startdate").val(),$("#starttime").val(),$("#enddate").val(),$("#endtime").val()),$("#mode").val(),n,d))}}var s,n,l=$(".js-selectionWidget-list"),o=$(".js-selectionWidget-pane"),r=l.hasClass("js-selectionWidget-chauffeur");s=[],l.on("click",".js-card",function(e){e.preventDefault();var a=$(this);a.data("id")&&a.data("model")?n.toggle(a):console.error("Selected card is missing id and model data.")}),o.on("click",".js-remove",function(e){e.preventDefault();var a=$(this).data("id"),i=l.find('.card[data-id="'+a+'"]');n.remove(i)}),$("#mode").on("change",function(){t(),e()}),e(),$(".js-datepicker-from").datepicker("option","onClose",function(){t()}),$(".js-datepicker-to").datepicker("option","onClose",function(){t()}),$("#starttime").on("change",function(){t()}),$("#endtime").on("change",function(){t()}),n={toggle:function(e){var a=$.grep(s,function(a){return a.id==e.data("id")});a.length>0?this.remove(e):this.add(e)},add:function(e){var a={id:e.data("id"),model:e.data("model")};if(r){for(;s.length;)s.pop();s.push(a),e.addClass("is-selected").parent().siblings().find(".is-selected").removeClass("is-selected"),e.find(".card-button").html('<span class="icon icon--tick"></span> Selected')}else s.push(a),e.addClass("is-selected"),e.find(".checker-label").text("Selected");t()},remove:function(e){s=s.filter(function(a){return a.id!==e.data("id")}),e.removeClass("is-selected"),e.find(".checker-label").text("Select"),r&&e.find(".card-button").html('<span class="icon icon--tick"></span> Select'),t()}}}function reloadLongTermWidget(){function e(){if(selectedCars.length>0?(selectionPane.addClass("is-active"),$("body").addClass("selectionPane-active")):(selectionPane.removeClass("is-active"),$("body").removeClass("selectionPane-active")),selectionChauffeur||(selectionPane.find("ul").empty(),$.each(selectedCars,function(e,a){var i=imgArray[a.id];selectionPane.find("ul").append('<li><a href="" data-id="'+a.id+'" class="icon icon--close-small selectionPane-remove js-remove"></a><figure> <img src="'+i+'" alt=""/></figure>'+a.model+"</li>");var t=selectionList.find('.card[data-id="'+a.id+'"]');t.addClass("is-selected"),t.find(".checker-label").text("Selected")})),selectionChauffeur){var e=selectedCars[0],a=selectionList.find('.card[data-id="'+e.id+'"] img').attr("src"),i=parseFloat(selectionList.find('.card[data-id="'+e.id+'"] span.card-hourly').html()),t=parseFloat(selectionList.find('.card[data-id="'+e.id+'"] span.card-pertrip').html());$("input[id=model]").val(e.model),selectionPane.find("span.card-pricing-value").html("$"+calculatePrice(findDuration($("#startdate").val(),$("#starttime").val(),$("#enddate").val(),$("#endtime").val()),$("#mode").val(),i,t)),selectionPane.find("figure img").attr("src",a).end().find(".js-selectionPane-model").text(e.model)}}if(selectionList=$(".js-selectionWidget-list"),selectionPane=$(".js-selectionWidget-pane"),selectionChauffeur=selectionList.hasClass("js-selectionWidget-chauffeur"),selectedCars.length>0)for(var a=0;a<selectedCars.length;a++){var i=selectedCars[a].id,t=selectionList.find('.card[data-id="'+i+'"]');t.length&&t.addClass("is-selected")}selectionList.on("click",".js-card",function(e){e.preventDefault();var a=$(this);a.data("id")&&a.data("model")?selectionController.toggle(a):console.error("Selected card is missing id and model data.")}),selectionPane.on("click",".js-remove",function(a){a.preventDefault();var i=$(this).data("id"),t=selectionList.find('.card[data-id="'+i+'"]');t.length?selectionController.remove(t):(selectedCars=selectedCars.filter(function(e){return e.id!==i}),e())}),selectionController={toggle:function(e){var a=$.grep(selectedCars,function(a){return a.id==e.data("id")});if(a.length>0)delete imgArray[e.data("id")],this.remove(e);else if(selectedCars.length<5){var i=e.find("img").attr("src");imgArray[e.data("id")]=i,this.add(e)}else alert("Maximum number of cars selected.")},add:function(a){var i={id:a.data("id"),model:a.data("model")};if(selectionChauffeur){for(;selectedCars.length;)selectedCars.pop();selectedCars.push(i),a.addClass("is-selected").parent().siblings().find(".is-selected").removeClass("is-selected"),a.find(".card-button").html('<span class="icon icon--tick"></span> Selected')}else selectedCars.push(i),a.addClass("is-selected"),a.find(".checker-label").text("Selected");e()},remove:function(a){selectedCars=selectedCars.filter(function(e){return e.id!==a.data("id")}),a.removeClass("is-selected"),a.find(".checker-label").text("Select"),selectionChauffeur&&a.find(".card-button").html('<span class="icon icon--tick"></span> Select'),e()}}}function initLongTermSelectionWidget(e){function a(){"PerTrip"==$("#mode").val()?($("label[for='enddate']").html("Return Date"),$("#enddate").prop("disabled",!0),$("#endtime").prop("disabled",!0),$("#enddate").val("")):($("label[for='enddate']").html('Return Date <span class="required">*</span>'),$("#enddate").prop("disabled",!1),$("#endtime").prop("disabled",!1))}var i=$(".js-selectionWidget-list");$(".js-selectionWidget-pane"),i.hasClass("js-selectionWidget-chauffeur");$("#mode").on("change",function(){updateSelectionPane(),a()}),a(),$(".js-datepicker-from").datepicker("option","onClose",function(){updateSelectionPane()}),$(".js-datepicker-to").datepicker("option","onClose",function(){updateSelectionPane()}),$("#starttime").on("change",function(){updateSelectionPane()}),$("#endtime").on("change",function(){updateSelectionPane()})}function initBrowseWidget(e,a){function t(e){if(window.history&&window.history.pushState){var a;a=_?{action:e,search:q,filter:$("#filterForm :input[value!='']").serialize().replace("l_mid=&","").replace("carMake=&","").replace("budget=&",""),searchForm:$("#searchForm :input[value!='']").serialize().replace("rangeStart=&","").replace("rangeStart=&","").replace("&address=selected","").replace("address=selected",""),sortby:$("#sortBy").val(),mid:z,model:_}:{action:e,search:q,filter:$("#filterForm :input[value!='']").serialize().replace("l_mid=&","").replace("carMake=&","").replace("budget=&",""),searchForm:$("#searchForm :input[value!='']").serialize().replace("rangeStart=&","").replace("rangeStart=&","").replace("&address=selected","").replace("address=selected",""),sortby:$("#sortBy").val()},E>0&&(a.page=E);var i="";V&&(i="&region="+V),history.pushState(a,e,"?data="+btoa(JSON.stringify(a))+i)}}function s(e){$("#sortBy").val(e.sortby);var a=$(".js-carType")[0].selectize,i=$(".js-carModel")[0].selectize;$.each(e.searchForm.split("&"),function(e,t){var s=t.split("=");if("types[]"==decodeURIComponent(s[0])){var n=decodeURIComponent(s[1].replace(/\+/g,"%20"));a.addOption({id:n,model:n}),a.refreshOptions(),a.addItem(decodeURIComponent(n))}else if("makemodel"==s[0]){var l=decodeURIComponent(s[1].replace(/\+/g,"%20")).trim();l.length>0&&$.each(l.split(","),function(e,a){var t=a;i.addOption({id:t,model:t}),i.refreshOptions(),i.addItem(t)})}else s[0]&&s[1]&&$("[name='"+s[0]+"']").val(decodeURIComponent(s[1].replace(/\+/g,"%20")))}),$.each(e.filter.split("&"),function(e,a){var i=a.split("=");"options[]"==decodeURIComponent(i[0])?$("input[name='"+decodeURIComponent(i[0].replace(/\+/g,"%20"))+"'][value='"+decodeURIComponent(i[1].replace(/\+/g,"%20"))+"']").prop("checked",!0):$("[name='"+i[0]+"']").val(decodeURIComponent(i[1].replace(/\+/g,"%20")))})}function n(e){s(e),Q=e.search?e.search+"&"+e.filter:e.filter,e.page&&(E=e.page),"viewAllModel"==e.action?(e.model&&(_=e.model),e.mid&&(z=e.mid),$("#l_mid").val(z),$("#viewAll").val("true"),I[I.length]=$.ajax({url:"/browseSpecificCarsList?mid="+z+"&viewAll=true",data:q+"&"+$("#filterForm :input[value!='']").serialize().replace("l_mid=&","").replace("carMake=&","").replace("budget=&","")+"&sortBy="+$("#sortBy").val()+"&"+D(),beforeSend:d,dataType:"json"}).done(function(e){M=e,H=e.counter,M.total=e.counter,P=1,E=0,r(),$(".js-pagination").html("&nbsp;")}).fail(function(e,a,i){C(e,a,i)})):($("#l_mid").val(""),$("#viewAll").val(""),I[I.length]=$.ajax({url:"/browseCarList?page="+(E+1),data:Q+"&sortBy="+$("#sortBy").val()+"&"+D(),beforeSend:d,dataType:"json"}).done(function(a){M=a,P=Math.ceil(a.total/H),H=15,r(),"selectModel"==e.action&&(_=e.model,z=e.mid,$("#l_mid").val(z),g(z,Q))}).fail(function(e,a,i){C(e,a,i)}))}function l(){$("#viewAllHeader").hide(),$(".l-browse-cards").hide(),$(".l-browse-tools").hide(),$(".pagination").hide()}function o(){$(".l-browse-cards").show(),$(".l-browse-tools").show(),$(".pagination").show(),$(".l-browse-list img").error(function(){$(this).attr("src","/images/default/carpic-cards.jpg")})}function r(e){M.total>0?("true"==$("#viewAll").val()&&($("#viewAllHeader").html('<h3 class="cardPopup-title">'+_+" <span>Showing "+M.total+" of "+M.total+" car models</span></h3>"),$("#viewAllHeader").show(),$(".js-pagination").html("&nbsp;")),e?v(e):v(),f(),p()):(c(),$("#noResults").show(),G=$.ajax({url:"/recommended-cars",data:q+"&"+$("#filterForm :input[value!='']").serialize().replace("l_mid=&","").replace("carMake=&","").replace("budget=&","")+"&sortBy="+$("#sortBy").val()}).done(function(e){$("#suggestion-list").html(e)}).fail(function(e,a,i){C(e,a,i)}))}function d(){$("#suggestions").hide(),$("#errors").hide(),G&&G.abort(),$("#suggestion-list").empty(),$("#noResults").hide(),$("#loadDiv").show(),$(".companyMarquee").length&&(void 0!==$(".companyMarquee").data("moveF")?$(".companyMarquee").coyMarquee("play"):$.isFunction($.fn.coyMarquee)&&$(".companyMarquee").coyMarquee()),$("html,body,document").animate({scrollTop:0},"slow"),l()}function c(){$(".companyMarquee").length&&void 0!==$(".companyMarquee").data("moveF")&&$(".companyMarquee").coyMarquee("pause"),$("#loadDiv").hide()}function p(){o(),c()}function u(e){var a="";for(i=0;i<5;i++)a+=i<e-1||e%1==0&&e-1==i?'<span class="icon icon--star-full"></span>':e%1!=0&&i==parseFloat(e.toString().split(".")[0])?'<span class="icon icon--star-half"></span>':'<span class="icon icon--star-empty"></span>';return a}function v(e){e||(e=E),U.empty(),S=H*e,T=S+H,T>M.total&&(T=M.total);var a=M.searchedLocation,i=M.results,t=0;i&&(t=i.length);var s=M.message,n=M.messageType;s&&n&&n&&($("#suggestionMsg").html("<p>"+s+"</p>"),$("#suggestions").show(),$(".tiptip").tipTip({activation:"hover",keepAlive:!1,delay:0,attribute:"title",defaultPosition:"top"}));for(var l,o,r,d,c,p,v,f,g,m,h=0;t>h;h++){o=i[h],l="",d='<div class="card-button">View car</div>',ratingDiv='<div class="cardtag-rating"><span class="noReviewDesc">No Ratings Yet<span></div>',o.rating&&(ratingDiv='<div class="cardtag-rating">'+u(o.rating)+'<span class="reviewDesc">'+(o.ratingNo>1?o.ratingNo+" Ratings":o.ratingNo+" Rating")+"</span></div>"),""!=a?(c='<div class="card-overlay"><span class="icon icon--location"></span>'+a+'<div class="cardtag-companyname">'+o.companyName+'</div> <div class="cardtag-companytype">'+o.companyType+"</div>"+ratingDiv+"</div>",a!=o.address&&(l='<li><span class="icon icon--stopwatch"></span>Advance Booking</li>')):c='<div class="card-overlay"><span class="icon icon--location"></span>'+o.address+'<div class="cardtag-companyname">'+o.companyName+'</div> <div class="cardtag-companytype">'+o.companyType+"</div>"+ratingDiv+"</div>",p="",v='<li><span class="icon icon--tick"></span>Malaysia</li>',m='<li><span class="icon icon--probation"><span class="path1"></span><span class="path2"></span></span>Probation</li>',r='<div class="card-callout">As low as<span>$'+o.price+"</span>/weekday</div>",o.counter<=1&&(r='<div class="card-callout">Get it at<span>$'+o.price+"</span>/weekday</div>"),"true"==$("#viewAll").val()&&(r='<div class="card-callout">Get it at<span>$'+o.price+"</span></div>"),g=o.buttonUrl,f="",-1!==$.inArray(o.id,O)&&(f=' <span class="tag card-tag">Most popular</span>'),v=1!=o.goMalaysia?"":'<li><span class="icon icon--tick"></span>Malaysia</li>',o.minExp>0&&(m=""),o.counter>1&&(d='<div class="card-button">View all '+o.counter+"</div>",p=" card--stack",c="",g="#",f="",m=""),(""!=v||""!=m)&&(v="<br/>"+v);var b=o.modeltype.toString().replace(/\s/g,"").toLowerCase();"sports"==b&&(b="supercar");var y=$('<li><a href="'+g+'" class="card'+p+'" data-model="'+o.model+'" data-model-id="'+o.mid+'">'+f+'<figure class="card-figure">'+r+'<img src="'+o.img+'"/>'+c+'</figure><div class="card-body"><h4 class="card-title">'+o.model+'</h4><div class="card-features"><ul><li><span class="icon icon--'+b+'"></span>'+o.modeltype+'</li><li><span class="icon icon--passenger"></span>'+o.passenger+"</li>"+v+m+l+"</ul></div></div>"+d+"</a></li>");U.append(y)}}function f(){function e(e){$("#l_mid"),I[I.length-1]&&I[I.length-1].abort(),I[I.length]=$.ajax({url:"/browseCarList?page="+(e+1),data:q+"&"+$("#filterForm :input[value!='']").serialize().replace("l_mid=&","").replace("carMake=&","").replace("budget=&","")+"&sortBy="+$("#sortBy").val()+"&"+D(),beforeSend:d,dataType:"json"}).done(function(i){M=i,t("navigatePage"),r(e),a()})}function a(){if($(".pagination-text").text(S+1+" - "+T+" of "+M.total+" car models"),F.eq(E).addClass("is-active").siblings(".is-active").removeClass("is-active"),F.first().hasClass("is-active")?W.find(".js-pagination-prev").addClass("is-disabled"):W.find(".js-pagination-prev").removeClass("is-disabled"),F.last().hasClass("is-active")?W.find(".js-pagination-next").addClass("is-disabled"):W.find(".js-pagination-next").removeClass("is-disabled"),F.size()>5){F.show();var e=E-2,a=E+2;4>a&&(a=4),P>a&&F.not($(".js-pagination-page:lt("+a+")")).hide(),e>P-5&&(e=P-5),3>E&&W.find(".pagination-gap-front").hide(),E>P-4&&W.find(".pagination-gap-end").hide(),e>-1&&F.not($(".js-pagination-page:gt("+e+")")).hide()}else W.find(".pagination-gap-front").hide(),W.find(".pagination-gap-end").hide();F.first().show(),F.last().show()}W.empty();var i="",s=0==E?"is-active":"";i+='<li class="js-pagination-page '+s+'"><a href="">1</a></li>',i+='<li class="pagination-gap-front pagination-gap is-disabled"><span>&hellip;</span></li>';for(var n=1;P-1>n;n++)s=n==E?"is-active":"",i+='<li class="js-pagination-page '+s+'"><a href="">'+(n+1)+"</a></li>";i+='<li class="pagination-gap-end pagination-gap is-disabled"><span>&hellip;</span></li>',P>1&&(s=P==E?"is-active":"",i+='<li class="js-pagination-page '+s+'"><a href="">'+P+"</a></li>");var l=M.total;l?W.html('<span class="pagination-text tiny">'+(S+1)+" - "+T+" of "+M.total+' car models</span><ul class="pagination-list"><li class="is-disabled js-pagination-prev"><a href="#"><span class="icon icon--arrow-left"></span></a></li><li class="js-pagination-next"><a href="#"><span class="icon icon--arrow-right"></span></a></li></ul>'):W.first().html('<span class="pagination-text tiny">0 - 0 of 0 car models</span><ul class="pagination-list"><li class="is-disabled js-pagination-prev"><a href="#"><span class="icon icon--arrow-left"></span></a></li><li class="js-pagination-next is-disabled"><a href="#"><span class="icon icon--arrow-right"></span></a></li></ul>'),P>1?(W.not(".js-pagination-arrows").find(".js-pagination-prev").after(i),F=W.find(".js-pagination-page"),!F.last().hasClass("is-active")&&l&&l>15?W.find(".js-pagination-next").removeClass("is-disabled"):W.find(".js-pagination-next").addClass("is-disabled"),W.unbind(),W.on("click","a",function(a){a.preventDefault();var i=$(this).closest("li");i.hasClass("js-pagination-prev")&&!i.hasClass("is-disabled")?E--:i.hasClass("js-pagination-next")&&!i.hasClass("is-disabled")?E++:i.hasClass("js-pagination-page")&&(E=F.index(i)),e(E)}),a()):$(".pagination-list").hide()}function g(e,a){A=$('a[data-model-id="'+e+'"]'),R=$(".js-browse-filter .js-datepicker-from").val(),L=$(".js-browse-filter .js-datepicker-to").val(),_=$('a[data-model-id="'+e+'"]').data("model"),z=$('a[data-model-id="'+e+'"]').data("model-id"),$("#l_mid").val(e),I[I.length-1]&&I[I.length-1].abort(),I[I.length]=$.ajax({url:"/browseSpecificCarsList?mid="+z,data:a+"&sortBy="+$("#sortBy").val()+"&"+D(),beforeSend:h,dataType:"json"}).done(function(e){y(e)}).fail(function(e,a,i){C(e,a,i)})}function m(e){var a=$(".js-carModel")[0].selectize,i=_;a.addOption({id:i,model:i}),a.addItem(i),$("#l_mid").val(e),I[I.length-1]&&I[I.length-1].abort(),I[I.length]=$.ajax({url:"/browseSpecificCarsList?mid="+e,data:q+"&"+$("#filterForm :input[value!='']").serialize().replace("l_mid=&","").replace("carMake=&","").replace("budget=&","")+"&"+D(),beforeSend:h,dataType:"json"}).done(function(e){y(e),t("selectModel")}).fail(function(e,a,i){C(e,a,i)})}function h(){$(".card.is-expanded").removeClass("is-expanded").parent("li").css("margin-bottom",""),$(".cardPopup").slideUp(),$(".cardPopup").detach();var e=$('<div id="model-list" class="cardPopup" ><div class="cardPopup-header"><h3 class="cardPopup-title">'+$(A).data("model")+'</h3><div style="padding-top:10px;padding-bottom:30px; text-align:center;"><img class="spinner" src="/images/loading_grey.gif" alt="Loading ...please wait."/>Loading ...please wait...</div></div></div>');$(A).addClass("is-expanded").parent().append(e),$(A).parent("li").css("margin-bottom","210px"),$(".cardPopup").slideDown(),$(document).trigger("ABhookStart")}function b(e){$("#viewAll").val("true"),I[I.length-1]&&I[I.length-1].abort(),I[I.length]=$.ajax({url:"/browseSpecificCarsList?mid="+e+"&viewAll=true",data:q+"&"+$("#filterForm :input[value!='']").serialize().replace("l_mid=&","").replace("carMake=&","").replace("budget=&","")+"&sortBy="+$("#sortBy").val()+"&"+D(),beforeSend:d,dataType:"json"}).done(function(e){M=e,H=e.counter,M.total=e.counter,t("viewAllModel"),P=1,E=0,r(),$(".js-pagination").html("&nbsp;")}).fail(function(e,a,i){C(e,a,i)})}function y(e){var a=6,i='<div class="cardPopup-more"><a class="button button--block" data-model-id="'+z+'">View all ('+e.counter+")</a></div>";e.counter<=6&&(a=e.counter,i="");var t,s,n,l,o,r,d=$('<div><div class="cardPopup-header"><h3 class="cardPopup-title">'+$(A).data("model")+" <span>Showing "+a+" of "+e.counter+' for this model</span></h3><a class="cardPopup-hide"><span class="icon icon--close"></span></a></div><ul class="l-browse-list l-browse-list--3"></ul>'+i+"</div>"),c=e.searchedLocation,p=e.results;$.each(p,function(e,a){t='<li><span class="icon icon--tick"></span>Malaysia</li>',l='<li><span class="icon icon--probation"><span class="path1"></span><span class="path2"></span></span>Probation</li>',r="",s="",-1!==$.inArray(a.id,O)&&(s=' <span class="tag card-tag">Most popular</span>'),1!=a.goMalaysia&&(t=""),a.minExp>0&&(l=""),(""!=t||""!=l)&&(t="<br/>"+t),n=a.modeltype.toString().replace(/\s/g,"").toLowerCase(),"sports"==n&&(n="supercar"),ratingDiv='<div class="cardtag-rating"><span class="reviewDesc">No Ratings Yet<span></div>',a.rating&&(ratingDiv='<div class="cardtag-rating">'+u(a.rating)+'<span class="reviewDesc">'+(a.ratingNo>1?a.ratingNo+" Ratings":a.ratingNo+" Rating")+"</span></div>"),""!=c?(o='<div class="card-overlay"><span class="icon icon--location"></span>'+c+'<div class="cardtag-companyname" >'+a.companyName+'</div> <div class="cardtag-companytype">'+a.companyType+"</div>"+ratingDiv+"</div>",c!=a.address&&(r='<li><span class="icon icon--stopwatch"></span>Advance Booking</li>')):o='<div class="card-overlay"><span class="icon icon--location"></span>'+a.address+'<div class="cardtag-companyname">'+a.companyName+'</div> <div class="cardtag-companytype">'+a.companyType+"</div>"+ratingDiv+"</div>",d.find(".l-browse-list").append('<li><a href="'+a.buttonUrl+'" class="card">'+s+'<figure class="card-figure"><div class="card-callout">Get it at<span>$'+a.price+'</span></div><img src="'+a.img+'"/>'+o+'</figure><div class="card-body"><div class="card-features"><ul><li><span class="icon icon--'+n+'"></span>'+a.modeltype+'</li><li><span class="icon icon--passenger"></span>'+a.passenger+"</li>"+t+l+r+'</ul></div></div><div class="card-button">View car</div></a></li>')}),$(A).parent().find(".cardPopup").empty(),$(A).parent().find(".cardPopup").append(d),$(A).siblings(".cardPopup").slideDown(function(){setTimeout(function(){var e=$(A).parent().find(".cardPopup").height(),a=50;$(A).parent("li").css("margin-bottom",e+a+"px")},100)}),$(".cardPopup-more").on("click","a",function(e){e.preventDefault(),$(".cardPopup").slideDown(),b($(this).data("model-id"))}),$(".cardPopup img").error(function(){$(this).attr("src","/images/default/carpic-cards.jpg")});var v=$("#model-list"),f=v.offset().top-$(".header").height()+6;setTimeout(function(){$("html,body,document").animate({scrollTop:f},"slow")},1e3),$(document).trigger("ABhookEnd")}function w(){if($("#l_mid").val()&&$("#viewAll").val()){var e=$("#l_mid").val();I[I.length-1]&&I[I.length-1].abort(),I[I.length]=$.ajax({url:"/browseSpecificCarsList?mid="+e+"&viewAll=true",data:q+"&"+$("#filterForm :input[value!='']").serialize().replace("l_mid=&","").replace("carMake=&","").replace("budget=&","")+"&sortBy="+$("#sortBy").val()+"&"+D(),beforeSend:d,dataType:"json"}).done(function(e){M=e,H=e.counter,M.total=e.counter,P=1,E=0,t("searchModel"),r(),$(".pagination-list").hide()}).fail(function(e,a,i){C(e,a,i)})}else I[I.length-1]&&I[I.length-1].abort(),I[I.length]=$.ajax({url:"/browseCarList",data:q+"&"+$("#filterForm :input[value!='']").serialize().replace("l_mid=&","").replace("carMake=&","").replace("budget=&","")+"&sortBy="+$("#sortBy").val()+"&"+D(),beforeSend:d,dataType:"json"}).done(function(e){M=e,P=Math.ceil(e.total/H),H=15,E=0,t("searchModel"),r()}).fail(function(e,a,i){C(e,a,i)})}function C(e,a,i){if(0!=e.readyState||"abort"!=a){var t="<p>Oops, it seems that there was a problem getting your request.Please try again.("+e.status+"-"+a+i+")</p>";c(),0===e.status&&(t="<p>There seems to be some problem connecting to Drive.SG. Please try again later.</p>"),$("#errorMsg").html(t),$("#errors").show(),l(),$("html,body,document").animate({scrollTop:0},"slow")}}function j(){q=$("#searchForm :input[value!='']").serialize().replace("rangeStart=&","").replace("rangeEnd=&","").replace("&address=selected","").replace("address=selected",""),V=""!==$("#address").val()&&"selected"!==$("#address").val()?$("#address :selected").parent().attr("label").toLowerCase():null,$("#l_mid").val(""),$("#viewAll").val(""),w()}function k(){w()}function x(){$('#filterForm input[type="checkbox"]').removeAttr("checked"),$("#budget").prop("selectedIndex",0),$("#age").prop("selectedIndex",5),$("#drivingExp").prop("selectedIndex",3),$("#carMake").prop("selectedIndex",0),k()}function D(){var e="";return window.location.href.indexOf("/wedding")>-1&&(e="urltype=wedding"),e}var M,P,S,T,F,A,L,B,R,N,_,z,Y,q,I=new Array,O=e,U=$(".js-browse-list"),W=$(".js-pagination"),E=0,H=15,G=null,V=null;if($(window).on("popstate",function(e){e.originalEvent.state&&n(e.originalEvent.state)}),$(window).resize(function(e){$(".cardPopup").length&&setTimeout(function(){$(".cardPopup").parent("li").css("margin-bottom",$(".cardPopup").height()+50+"px")},1e3)}),"undefined"==typeof Y){var J;if(J=new RegExp("[?&]data=([^&]*)").exec(location.search))try{Y=JSON.parse(atob(J[1]))}catch(K){}}$("#clear_filter").click(function(e){e.preventDefault(),x()}),$("#searchMobileSubmit").click(function(){j();var e=$(".l-browse-content").first();$("html,body,document").animate({scrollTop:e.offset().top},"slow")}),$("#searchSubmit").click(function(){j()}),$("#sortBy").change(function(){k()}),$('#filterForm input[type="checkbox"]').change(function(){k()}),$("#rating").change(function(){k()}),$("#budget").change(function(){k()}),$("#age").change(function(){k()}),$("#drivingExp").change(function(){k()}),$("#carMake").change(function(){k()});var Q="";q=$("#searchForm :input[value!='']").serialize().replace("rangeStart=&","").replace("rangeEnd=&","").replace("&address=selected","").replace("address=selected",""),Q=q?q+"&"+$("#filterForm :input[value!='']").serialize().replace("l_mid=&","").replace("carMake=&","").replace("budget=&",""):$("#filterForm :input[value!='']").serialize().replace("l_mid=&","").replace("carMake=&","").replace("budget=&",""),d(),I[I.length-1]&&I[I.length-1].abort(),"undefined"==typeof Y?I[I.length]=$.ajax({url:"/browseCarList",data:Q+"&"+D(),beforeSend:d,dataType:"json"}).done(function(e){M=e,P=Math.ceil(e.total/H),window.history&&window.history.pushState&&t("init"),H=15,r()}).fail(function(e,a,i){C(e,a,i)}):n(Y),U.on("click",".card--stack",function(e){e.preventDefault(),A=this,R=$(".js-browse-filter .js-datepicker-from").val(),L=$(".js-browse-filter .js-datepicker-to").val(),_=$(this).data("model"),z=$(this).data("model-id"),R&&(N=moment(R,"D MMMM YYYY").format("YYYY-MM-DD")),L&&(B=moment(L,"D MMMM YYYY").format("YYYY-MM-DD")),m(z)}),Array.prototype.filter||(Array.prototype.filter=function(e){"use strict";if(void 0===this||null===this)throw new TypeError;var a=Object(this),i=a.length>>>0;if("function"!=typeof e)throw new TypeError;for(var t=[],s=arguments[1],n=0;i>n;n++)if(n in a){var l=a[n];e.call(s,l,n,a)&&t.push(l)}return t})}$(document).ready(function(){function e(e){$(".tab-content").find(e).addClass("is-active").siblings(".is-active").removeClass("is-active"),$(".slick-slider").slickSetOption("accessibility",!0,!0)}function a(){$(window).scrollTop()>=s-t?(i.next().hasClass("stickyShim")||i.after('<div class="stickyShim"></div>').next().css("height",n),i.css({position:"fixed",width:i.parent().width(),"z-index":3,top:0+t}),$("#similarCars").offset()&&(i.offset().top+n>=$("#similarCars").offset().top&&i.hasClass("view-carLinks")?i.hide():i.show()),i.offset().top+n>=l&&i.hasClass("js-help-questions")?i.css({position:"",top:""}).addClass("is-anchored"):i.removeClass("is-anchored")):i.css({position:"static",width:"auto"}).next(".stickyShim").remove()}$(window).width()<=960?!0:!1;$(".js-dropdown .js-dropdown-toggle").on("click",function(e){e.preventDefault(),e.stopPropagation(),$(this).parent(".js-dropdown").toggleClass("is-expanded"),$(".js-dropdown.is-expanded").not($(this).parent()).removeClass("is-expanded")}),$(document).on("click",function(){$(".js-dropdown").removeClass("is-expanded")}),$(".js-toggle").on("click",".js-toggle-button",function(e){if($(this).hasClass("checker")){if(!$(e.target).is("input"))return}else e.preventDefault();$(this).closest(".js-toggle").toggleClass("is-expanded").siblings(".is-expanded").removeClass("is-expanded"),$(this).closest(".js-toggle").hasClass("js-toggle--mobile")&&$("body").css("overflow","hidden"),e.stopPropagation()}),$(".js-toggle-close").click(function(){$(this).closest(".js-toggle").removeClass("is-expanded"),$(this).closest(".js-toggle").hasClass("js-toggle--mobile")&&$("body").css("overflow","initial")}),$(".js-tab .tab-nav").on("click",".button",function(a){a.preventDefault(),$(this).addClass("is-active").siblings(".is-active").removeClass("is-active");var i=$(this).attr("href");e(i)}),$(".js-tab .tab-nav").on("change","select",function(a){a.preventDefault();var i=$(this).val();e(i)}),$(".js-grouping--button").on("click",".button",function(e){e.preventDefault();var a=$(this).closest(".js-grouping--button").outerHeight();$(this).addClass("is-active").siblings(".is-active").removeClass("is-active");var i=$(this).attr("href");if("#"==i.charAt(0)){var t=$(i).offset().top;$("html, body,document").animate({scrollTop:t-a-10})}}),$(".js-mobileTab").on("click","a",function(e){e.preventDefault(),$(this).addClass("is-active").siblings(".is-active").removeClass("is-active");var a=$(this).attr("href");$(a).parent(".mobileTab-content").addClass("is-active").siblings(".is-active").removeClass("is-active")}),$(".js-mobileNav-toggle").click(function(e){e.preventDefault(),$this=$(this),$(".mobileNav").addClass("is-active"),$this.hasClass("is-active")?($this.removeClass("is-active"),$(".mobileNav.is-active").removeClass("is-active"),$("body.nav-open").removeClass("nav-open")):($this.addClass("is-active"),$(".mobileNav").addClass("is-active"),$("body").addClass("nav-open"))});var i=$(".js-sticky"),t=0;if(i.length){var s=i.offset().top,n=i.height(),l=$(".footer-container").offset().top;$(window).scroll(a)}$(".js-browse-list").on("click",".cardPopup-hide",function(e){e.preventDefault(),$(".cardPopup").slideUp(),$(".cardPopup").detach(),$(".card.is-expanded").removeClass("is-expanded").parent("li").css("margin-bottom","")}),$(".js-help-questions").on("click","a",function(e){e.preventDefault(),$(this).parent("li").addClass("is-active").siblings(".is-active").removeClass("is-active");var a=$(this).attr("href"),i=$(a).offset().top;$("html,body,document").animate({scrollTop:i})}),$(".pageBanner-more-button").click(function(e){e.preventDefault();var a=$(".pageBanner").height();$("html,body,document").animate({scrollTop:a})}),$(".js-validate").validate({highlight:function(e){$(e).parent().addClass("is-alert")},unhighlight:function(e){$(e).parent().removeClass("is-alert")}}),$(".js-checkoutOptions").on("click","a",function(e){e.preventDefault();var a=$(this).attr("href");$(this).addClass("is-active").siblings(".is-active").removeClass("is-active"),$(a).addClass("is-active is-expanded").siblings(".is-active").removeClass("is-active is-expanded")}),$(".js-payment-next").click(function(e){e.preventDefault(),$(".mobile-payment-1").removeClass("is-active"),$(".mobile-payment-2").addClass("is-active")})});